---
title: "Task1"
author: "Mihir"
date: "03/11/2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libraries, warnings = FALSE, message = FALSE}
library(ggplot2)
library(dplyr)
library(tidyr)
library(rio)
library(knitr)
library(readxl)
library(lubridate)
```

```{r data_manipulations}
#Import
maindat <- read_excel("edited_spotify.xlsx")
View(maindat)

#NA Removal
maindat <- na.omit({ 
  maindat %>%
    group_by(Artist, AlbumName, AlbumReleaseDate, ArtistPopularity)
})

#Date Parsing
maindat$AlbumReleaseDate = as.Date(parse_date_time(maindat$AlbumReleaseDate, orders = c("y", "ym", "ymd")))

#Grouping data by albums because there is no data to calculate an individual track's popularity.
albumdat = {maindat %>% 
    group_by(Artist,ArtistPopularity,AlbumName,
             AlbumReleaseDate,AlbumPopularity,ArtistNumFollowers,
             AlbumWeeksOnChart,AlbumWeeksNumberOne,
             AlbumBestChartPosition) %>% 
    summarise(AlbumDuration = mean(TrackDuration),
              AlbumDanceability = mean(TrackDanceability),
              AlbumEnergy = mean(TrackEnergy),
              AlbumLoudness = mean(TrackLoudness),
              AlbumSpeechiness = mean(TrackSpeechiness),
              AlbumAcousticness = mean(TrackAcousticness),
              AlbumInstrumentalness = mean(TrackInstrumentalness),
              AlbumLiveness = mean(TrackLiveness),
              AlbumValence = mean(TrackValence),
              AlbumTempo = mean(TrackTempo)
               )}

#Calculating the AlbumPopularityRating for each album.
albumdat <- {albumdat %>% 
  group_by(Artist, AlbumName, AlbumReleaseDate) %>%
    mutate(AlbumPopularityRating = 
              ((ArtistPopularity + AlbumPopularity)/2) +
              (ArtistNumFollowers/10^7) +
              (AlbumWeeksOnChart/100) +
              (AlbumWeeksNumberOne/10) +
              (1 - (AlbumBestChartPosition/100))) 
              }
head(albumdat)

#ArtistPopularityRating is an average of all AlbumPopularityRatings for that artist.
artistdat <- {albumdat %>% 
    group_by(Artist) %>%
    summarise(ArtistPopularityRating = mean(AlbumPopularityRating))}
head(artistdat)

summary(albumdat)
```


```{r EDA, include = FALSE}
plot.durationpop <- {albumdat %>% ggplot(aes(x = AlbumDuration,
                                                y = PopularityRating))} +
  geom_point()  + geom_smooth() + xlab("Album's Average Duration") +
        ylab("Album's Popularity Rating") +
        ggtitle("Duration vs Popularity")
plot.durationpop

plot.dancepop <- {albumdat %>% ggplot(aes(y = AlbumDanceability,
                                                x = PopularityRating))} +
  geom_point()  + geom_smooth() + ylab("Album's Average Danceability") +
        xlab("Album's Popularity Rating") +
        ggtitle("Popularity vs Danceability")
plot.dancepop

plot.energypop <- {albumdat %>% ggplot(aes(y = AlbumEnergy,
                                                x = PopularityRating))} +
  geom_point()  + geom_smooth() + ylab("Album's Average Energy") +
        xlab("Album's Popularity Rating") +
        ggtitle("Popularity vs AlbumEnergy")
plot.energypop

plot.speechypop <- {albumdat %>% ggplot(aes(y = AlbumSpeechiness,
                                                x = PopularityRating))} +
  geom_point()  + geom_smooth() + ylab("Album's Average Speechiness") +
        xlab("Album's Popularity Rating") +
        ggtitle("Popularity vs Speechiness")
plot.speechypop


```

```{r models}

ggplot(albumdat, aes(x = AlbumPopularityRating, y = AlbumEnergy)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red")

```